---
description: 根据用户要求为当前特性生成自定义检查清单。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 检查清单目的: "英语的单元测试"

**关键概念**: 检查清单是**要求编写的单元测试** - 它们验证给定领域中要求的质量、清晰度和完整性。

**不用于验证/测试**:

- ❌ 不是 "验证按钮点击正确"
- ❌ 不是 "测试错误处理工作"
- ❌ 不是 "确认API返回200"
- ❌ 不是检查代码/实施是否匹配规格

**用于要求质量验证**:

- ✅ "是否为所有卡片类型定义了视觉层次要求？"（完整性）
- ✅ "'突出显示'是否用具体的大小/定位量化？"（清晰度）
- ✅ "悬停状态要求在所有交互元素中是否一致？"（一致性）
- ✅ "是否为键盘导航定义了辅助功能要求？"（覆盖）
- ✅ "规格是否定义了徽标图像加载失败时会发生什么？"（边界情况）

**比喻**: 如果您的规格是用英语编写的代码，检查清单就是它的单元测试套件。您正在测试要求是否编写得好、完整、明确且准备好实施 - 而不是实施是否有效。

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果不为空）。

## 执行步骤

1. **设置**: 从仓库根目录运行 `{SCRIPT}` 并解析JSON中的 FEATURE_DIR 和 AVAILABLE_DOCS 列表。
   - 所有文件路径必须是绝对路径。
   - 对于参数中的单引号，如"I'm Groot"，使用转义语法：例如 'I'\''m Groot'（或如果可能使用双引号："I'm Groot"）。

2. **澄清意图（动态）**: 从用户的措辞和从spec/plan/tasks提取的信号中派生最多三个初始上下文澄清问题（没有预先烘焙的目录）。它们**必须**:
   - 从用户的措辞 + 从spec/plan/tasks提取的信号生成
   - 仅询问实质性改变检查清单内容的信息
   - 如果在 `$ARGUMENTS` 中已经明确，则单独跳过
   - 更喜欢精确而不是广度

   生成算法:
   1. 提取信号: 特性领域关键词（例如，auth、latency、UX、API）、风险指标（"关键"、"必须"、"合规"）、利益相关者提示（"QA"、"审查"、"安全团队"）和明确的可交付成果（"a11y"、"回滚"、"契约"）。
   2. 将信号聚类到候选焦点区域（最多4个），按相关性排名。
   3. 如果不明确，识别可能的受众和时间（作者、审查者、QA、发布）。
   4. 检测缺失维度: 范围广度、深度/严格性、风险强调、排除边界、可衡量的验收标准。
   5. 从这些原型中选择制定问题:
      - 范围细化（例如，"这应该包括与X和Y的集成接触点还是保持限制在本地模块正确性？"）
      - 风险优先级（例如，"这些潜在风险领域中哪些应该接受强制性门控检查？"）
      - 深度校准（例如，"这是轻量级的预提交理智列表还是正式的发布门控？"）
      - 受众框架（例如，"这将仅由作者使用还是在PR审查期间由同行使用？"）
      - 边界排除（例如，"我们应该明确排除本轮的性能调优项目吗？"）
      - 场景类差距（例如，"未检测到恢复流程 - 回滚/部分失败路径在范围内吗？"）

   问题格式规则:
   - 如果呈现选项，生成带有列的紧凑表: 选项 | 候选 | 为什么重要
   - 最多限制A-E选项；如果自由形式答案更清晰，则省略表
   - 永远不要要求用户重述他们已经说过的话
   - 避免推测性类别（无虚构）。如果不确定，明确询问: "确认X是否属于范围。"

   无法交互时的默认值:
   - 深度: 标准
   - 受众: 如果与代码相关则为审查者（PR）；否则为作者
   - 焦点: 前2个相关性聚类

   输出问题（标记Q1/Q2/Q3）。回答后: 如果≥2个场景类（替代/异常/恢复/非功能领域）仍不清楚，您可以提出最多两个更有针对性的后续问题（Q4/Q5），每个都有一行理由（例如，"未解决的恢复路径风险"）。不要超过五个总问题。如果用户明确拒绝更多，则跳过升级。

3. **理解用户请求**: 组合 `$ARGUMENTS` + 澄清答案:
   - 派生检查清单主题（例如，安全、审查、部署、用户体验）
   - 整合用户提到的明确必须有的项目
   - 将焦点选择映射到类别脚手架
   - 从spec/plan/tasks推断任何缺失的上下文（不要虚构）

4. **加载特性上下文**: 从 FEATURE_DIR 读取:
   - spec.md: 特性要求和范围
   - plan.md（如果存在）: 技术细节、依赖关系
   - tasks.md（如果存在）: 实施任务

   **上下文加载策略**:
   - 仅加载与活动焦点区域相关的必要部分（避免完整文件转储）
   - 更喜欢将长部分总结为简洁的场景/要求项目符号
   - 使用渐进披露: 仅在检测到差距时添加后续检索
   - 如果源文档很大，生成临时摘要项目而不是嵌入原始文本

5. **生成检查清单** - 创建"要求的单元测试":
   - 如果不存在则创建 `FEATURE_DIR/checklists/` 目录
   - 生成唯一的检查清单文件名:
     - 根据领域使用简短、描述性名称（例如，`ux.md`、`api.md`、`security.md`）
     - 格式: `[领域].md`
     - 如果文件存在，追加到现有文件
   - 从CHK001开始按顺序编号项目
   - 每次 `/speckit.checklist` 运行创建一个新文件（永远不会覆盖现有检查清单）

   **核心原则 - 测试要求，而不是实施**:
   每个检查清单项目**必须**评估要求本身的:
   - **完整性**: 是否存在所有必要的要求？
   - **清晰度**: 要求是否明确且具体？
   - **一致性**: 要求彼此是否一致？
   - **可衡量性**: 要求是否可以客观验证？
   - **覆盖**: 是否解决了所有场景/边界情况？

   **类别结构** - 按要求质量维度对项目分组:
   - **要求完整性**（是否记录了所有必要的要求？）
   - **要求清晰度**（要求是否具体且明确？）
   - **要求一致性**（要求是否在没有冲突的情况下一致？）
   - **验收标准质量**（成功标准是否可衡量？）
   - **场景覆盖**（是否解决了所有流程/情况？）
   - **边界情况覆盖**（是否定义了边界条件？）
   - **非功能性要求**（性能、安全、辅助功能等 - 是否指定？）
   - **依赖关系和假设**（它们是否被记录和验证？）
   - **歧义和冲突**（需要澄清什么？）

   **如何编写检查清单项目 - "英语的单元测试"**:

   ❌ **错误**（测试实施）:
   - "验证登录页面显示3个剧集卡片"
   - "测试悬停状态在桌面上工作"
   - "确认徽标点击导航到主页"

   ✅ **正确**（测试要求质量）:
   - "是否指定了特色剧集的确切数量和布局？"[完整性]
   - "'突出显示'是否用具体的大小/定位量化？"[清晰度]
   - "悬停状态要求在所有交互元素中是否一致？"[一致性]
   - "是否为所有交互UI定义了键盘导航要求？"[覆盖]
   - "是否指定了徽标图像加载失败时的回退行为？"[边界情况]
   - "是否为异步剧集数据定义了加载状态？"[完整性]
   - "规格是否定义了竞争UI元素的视觉层次？"[清晰度]

   **项目结构**:
   每个项目应遵循此模式:
   - 询问要求质量的问题格式
   - 关注规格/计划中写的内容（或未写的内容）
   - 在括号中包含质量维度 [完整性/清晰度/一致性/等]
   - 检查现有要求时引用规格部分 `[规格 §X.Y]`
   - 检查缺失要求时使用 `[差距]` 标记

   **按质量维度的示例**:

   完整性:
   - "是否为所有API失败模式定义了错误处理要求？[差距]"
   - "是否为所有交互元素指定了辅助功能要求？[完整性]"
   - "是否为响应式布局定义了移动断点要求？[差距]"

   清晰度:
   - "'快速加载'是否用具体的时间阈值量化？[清晰度，规格 §NFR-2]"
   - "'相关剧集'选择标准是否明确定义？[清晰度，规格 §FR-5]"
   - "'突出'是否用可衡量的视觉属性定义？[歧义，规格 §FR-4]"

   一致性:
   - "导航要求在所有页面中是否一致？[一致性，规格 §FR-10]"
   - "登录页面和详情页面之间的卡片组件要求是否一致？[一致性]"

   覆盖:
   - "是否为零状态场景（无剧集）定义了要求？[覆盖，边界情况]"
   - "是否解决了并发用户交互场景？[覆盖，差距]"
   - "是否为部分数据加载失败指定了要求？[覆盖，异常流程]"

   可衡量性:
   - "视觉层次要求是否可衡量/可测试？[验收标准，规格 §FR-1]"
   - "'平衡的视觉权重'是否可以客观验证？[可衡量性，规格 §FR-2]"

   **场景分类和覆盖**（要求质量焦点）:
   - 检查是否存在要求: 主要、替代、异常/错误、恢复、非功能场景
   - 对于每个场景类，询问: "[场景类型]要求是否完整、清晰且一致？"
   - 如果场景类缺失: "[场景类型]要求是有意排除还是缺失？[差距]"
   - 当状态突变发生时包括韧性/回滚: "是否为迁移失败定义了回滚要求？[差距]"

   **可追溯性要求**:
   - 最少: ≥80%的项目**必须**包括至少一个可追溯性引用
   - 每个项目应引用: 规格部分 `[规格 §X.Y]`，或使用标记: `[差距]`、`[歧义]`、`[冲突]`、`[假设]`
   - 如果不存在ID系统: "是否建立了要求和验收标准ID方案？[可追溯性]"

   **表面和解决问题**（要求质量问题）:
   询问关于要求本身的问题:
   - 歧义: "术语'快速'是否用具体指标量化？[歧义，规格 §NFR-1]"
   - 冲突: "§FR-10和§FR-10a之间的导航要求是否冲突？[冲突]"
   - 假设: "'始终可用的播客API'假设是否已验证？[假设]"
   - 依赖关系: "是否记录了外部播客API要求？[依赖关系，差距]"
   - 缺失定义: "'视觉层次'是否用可衡量的标准定义？[差距]"

   **内容整合**:
   - 软上限: 如果原始候选项目> 40，按风险/影响排序
   - 合并检查相同要求方面的近重复项
   - 如果>5个低影响边界情况，创建一个项目: "要求中是否解决了边界情况X、Y、Z？[覆盖]"

   **🚫 绝对禁止** - 这些使其成为实施测试，而不是要求测试:
   - ❌ 任何以"验证"、"测试"、"确认"、"检查" + 实施行为开头的项目
   - ❌ 对代码执行、用户操作、系统行为的引用
   - ❌ "正确显示"、"正常工作"、"按预期运作"
   - ❌ "点击"、"导航"、"渲染"、"加载"、"执行"
   - ❌ 测试用例、测试计划、QA程序
   - ❌ 实施细节（框架、API、算法）

   **✅ 必需模式** - 这些测试要求质量:
   - ✅ "是否为[场景]定义/指定/记录了[要求类型]？"
   - ✅ "[模糊术语]是否用具体标准量化/澄清？"
   - ✅ "[部分A]和[部分B]之间的要求是否一致？"
   - ✅ "[要求]是否可以客观衡量/验证？"
   - ✅ "要求中是否解决了[边界情况/场景]？"
   - ✅ "规格是否定义了[缺失方面]？"

6. **结构参考**: 按照 `templates/checklist-template.md` 中的规范模板生成检查清单，用于标题、元部分、类别标题和ID格式。如果模板不可用，使用: H1标题、目的/创建元行、`##` 类别部分包含 `- [ ] CHK### <要求项目>` 行，全局递增ID从CHK001开始。

7. **报告**: 输出创建的检查清单的完整路径、项目计数，并提醒用户每次运行都会创建一个新文件。总结:
   - 选择的焦点区域
   - 深度级别
   - 参与者/时间
   - 纳入的任何明确用户指定的必须有项目

**重要**: 每次 `/speckit.checklist` 命令调用都使用简短、描述性名称创建检查清单文件，除非文件已存在。这允许:

- 不同类型的多个检查清单（例如，`ux.md`、`test.md`、`security.md`）
- 指示检查清单目的的简单、易记的文件名
- `checklists/` 文件夹中的轻松识别和导航

为避免混乱，使用描述性类型并在完成后清理过时的检查清单。

## 示例检查清单类型和示例项目

**用户体验要求质量:** `ux.md`

示例项目（测试要求，而不是实施）:

- "是否用可衡量的标准定义了视觉层次要求？[清晰度，规格 §FR-1]"
- "是否明确指定了UI元素的数量和定位？[完整性，规格 §FR-1]"
- "交互状态要求（悬停、焦点、活动）是否一致定义？[一致性]"
- "是否为所有交互元素指定了辅助功能要求？[覆盖，差距]"
- "是否定义了图像加载失败时的回退行为？[边界情况，差距]"
- "'突出显示'是否可以客观衡量？[可衡量性，规格 §FR-4]"

**API要求质量:** `api.md`

示例项目:

- "是否为所有失败场景指定了错误响应格式？[完整性]"
- "速率限制要求是否用具体阈值量化？[清晰度]"
- "认证要求在所有端点中是否一致？[一致性]"
- "是否为外部依赖关系定义了重试/超时要求？[覆盖，差距]"
- "要求中是否记录了版本控制策略？[差距]"

**性能要求质量:** `performance.md`

示例项目:

- "性能要求是否用具体指标量化？[清晰度]"
- "是否为所有关键用户旅程定义了性能目标？[覆盖]"
- "是否指定了不同负载条件下的性能要求？[完整性]"
- "性能要求是否可以客观衡量？[可衡量性]"
- "是否为高负载场景定义了降级要求？[边界情况，差距]"

**安全要求质量:** `security.md`

示例项目:

- "是否为所有受保护资源指定了认证要求？[覆盖]"
- "是否为敏感信息定义了数据保护要求？[完整性]"
- "威胁模型是否已记录且要求与之一致？[可追溯性]"
- "安全要求是否与合规义务一致？[一致性]"
- "是否定义了安全失败/违规响应要求？[差距，异常流程]"

## 反例: 不要做什么

**❌ 错误 - 这些测试实施，而不是要求:**

```markdown
- [ ] CHK001 - 验证登录页面显示3个剧集卡片 [规格 §FR-001]
- [ ] CHK002 - 测试悬停状态在桌面上正常工作 [规格 §FR-003]
- [ ] CHK003 - 确认徽标点击导航到主页 [规格 §FR-010]
- [ ] CHK004 - 检查相关剧集部分显示3-5个项目 [规格 §FR-005]
```

**✅ 正确 - 这些测试要求质量:**

```markdown
- [ ] CHK001 - 是否明确指定了特色剧集的数量和布局？[完整性，规格 §FR-001]
- [ ] CHK002 - 是否为所有交互元素一致定义了悬停状态要求？[一致性，规格 §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航要求是否清晰？[清晰度，规格 §FR-010]
- [ ] CHK004 - 是否记录了相关剧集的选择标准？[差距，规格 §FR-005]
- [ ] CHK005 - 是否为异步剧集数据定义了加载状态要求？[差距]
- [ ] CHK006 - "视觉层次"要求是否可以客观衡量？[可衡量性，规格 §FR-001]
```

**关键差异:**

- 错误: 测试系统是否正常工作
- 正确: 测试要求是否正确编写
- 错误: 行为验证
- 正确: 要求质量验证
- 错误: "它是否执行X？"
- 正确: "X是否清晰指定？"
